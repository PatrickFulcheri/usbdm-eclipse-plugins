<?xml version="1.0" encoding="ISO-8859-1"?>
<template
   type="ProjTempl"
   version="1.0"
   supplier="pgo"
   revision="1.0"
   author="Peter O'Donoghue"
   id="ColdfireV1C"
   label="Coldfire V1 C Project"
   description="A Basic GCC Project for Coldfire V1 with USBDM debug support."
   help="help.html"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:noNamespaceSchemaLocation='..//TemplateDescriptorSchema.xsd'>
   <property-group
      id="usbdm_properties"
      label="USBDM Settings"
      description="USBDM specific project properties"
      type="PAGES-ONLY"
      help="help.html">
   </property-group>
   
   <!-- 
         Create folder structure 
     -->
   <process type="org.eclipse.cdt.managedbuilder.core.NewManagedProject">
      <simple name="name"              value="$(projectName)" /> 
      <simple name="artifactExtension" value="elf" /> 
      <simple name="isCProject"        value="true" /> 
   </process>
   <process type="org.eclipse.cdt.core.CreateSourceFolder">
      <simple name="projectName"  value="$(projectName)" />
      <simple name="path"         value="Sources" />
   </process>
   <process type="org.eclipse.cdt.core.CreateSourceFolder">
      <simple name="projectName"  value="$(projectName)" />
      <simple name="path"         value="Startup_Code" />
   </process>
   <process type="org.eclipse.cdt.core.CreateFolder">
      <simple name="projectName"  value="$(projectName)" />
      <simple name="path"         value="Project_Settings" />
   </process>
   <process type="net.sourceforge.usbdm.cdt.ui.CreateIncludeFolder">
      <simple name="projectName"  value="$(projectName)" />
      <simple name="path"         value="Project_Headers" />
   </process>

   <!-- 
         Add simple files from template directory
     -->
   <process type="org.eclipse.cdt.core.AddFiles">
      <simple name="projectName"  value="$(projectName)" />
      <complex-array name="files">
         <element>
            <simple name="source"      value="Project_Headers/derivative.h" />
            <simple name="target"      value="Project_Headers/derivative.h" />
            <simple name="replaceable" value="true" />
         </element>
         <element>
            <simple name="source"       value="Project_Settings/Debug.launch" />
            <simple name="target"       value="Project_Settings/$(projectName)-Debug.launch" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Project_Settings/MemoryMap.ld" />
            <simple name="target"       value="Project_Settings/MemoryMap-$(targetDeviceName).ld" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Project_Settings/Codesourcery-rom.ld" />
            <simple name="target"       value="Project_Settings/Codesourcery-rom.ld" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Project_Settings/Codesourcery-ram.ld" />
            <simple name="target"       value="Project_Settings/Codesourcery-ram.ld" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Project_Settings/Codesourcery-rom-hosted.ld" />
            <simple name="target"       value="Project_Settings/Codesourcery-rom-hosted.ld" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Project_Settings/Codesourcery-ram-hosted.ld" />
            <simple name="target"       value="Project_Settings/Codesourcery-ram-hosted.ld" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Sources/main.c" />
            <simple name="target"       value="Sources/main.c" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Startup_Code/startup_Codesourcery_c.c" />
            <simple name="target"       value="Startup_Code/startup_Codesourcery_c.c" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Startup_Code/startup_Codesourcery.S" />
            <simple name="target"       value="Startup_Code/startup_Codesourcery.S" />
            <simple name="replaceable"  value="true" />
         </element>
         <element>
            <simple name="source"       value="Startup_Code/sysinit.c" />
            <simple name="target"       value="Startup_Code/sysinit.c" />
            <simple name="replaceable"  value="true" />
         </element>
      </complex-array>
   </process>
   
   <!-- 
         Add project settings 
     -->
   <process
      type="org.eclipse.cdt.managedbuilder.core.SetMBSStringOptionValue">
      <simple name="projectName" value="$(projectName)" />
      <complex-array name="resourcePaths">
         <element>
            <simple name="id"    value="net.sourceforge.usbdm.cdt.toolchain.c.linker.linkerFile" />
            <simple name="value" value="${ProjDirPath}/Project_Settings/$(linkerFile)" />
            <simple name="path"  value="" />
         </element>
         <element>
            <simple name="id"    value="net.sourceforge.usbdm.cdt.toolchain.cpp.linker.linkerFile" />
            <simple name="value" value="${ProjDirPath}/Project_Settings/$(linkerFile)" />
            <simple name="path"  value="" />
         </element>
         <element>
            <simple name="id"    value="net.sourceforge.usbdm.cdt.coldfire.toolchain.buildtools" />
            <simple name="value" value="$(buildToolId)" />
            <simple name="path"  value="" />
         </element>
      </complex-array>
   </process>
   
   <!-- 
         Add project nature
     -->
   <process
      type="net.sourceforge.usbdm.cdt.ui.AddNature">
      <simple name="projectName"    value="$(projectName)" />
      <simple name="nature"         value="net.sourceforge.usbdm.cdt.tools.ColdfireProjectNature" />
   </process>
   
   <!-- 
         Add external files 
     -->
   <process
      type="net.sourceforge.usbdm.cdt.ui.AddExternalFiles">
      <simple name="projectName"          value="$(projectName)" />
      <complex-array name="copyList">
         <element>
            <!-- Copy optional external file for custom linker -->
            <simple name="externalSource"    value="$(externalLinkerScript)" />
            <simple name="internalSource"    value="" />
            <simple name="target"            value="Project_Settings/Custom.ld" />
            <simple name="replaceable"       value="true" />
         </element>
         <element>
            <simple name="externalSource"    value="$(externalHeaderFile)" />
            <simple name="internalSource"    value="Project_Headers/TargetDevice.h" />
            <simple name="target"            value="Project_Headers/$(targetDevice).h" />
            <simple name="replaceable"       value="true" />
         </element>
         <element>
            <simple name="externalSource"    value="$(externalVectorTable)" />
            <simple name="internalSource"    value="Startup_Code/vectors.c" />
            <simple name="target"            value="Startup_Code/vectors.c" />
            <simple name="replaceable"       value="true" />
         </element>
      </complex-array>
   </process>
   
   <!-- 
         Add device specific options from USBDM device database
     -->
   <process
      type="net.sourceforge.usbdm.cdt.ui.ProcessUsbdmSettings">
      <simple name="projectName"          value="$(projectName)" />
      <simple name="targetDeviceFamily"   value="$(targetDeviceFamily)" />
      <simple name="targetDevice"         value="$(targetDevice)" />
   </process>

   <!-- 
         Add target files based upon options from USBDM device database
     -->
   <process
      type="net.sourceforge.usbdm.cdt.ui.AddTargetFiles">
      <simple name="projectName"          value="$(projectName)" />
      <simple name="targetDeviceFamily"   value="$(targetDeviceFamily)" />
      <simple name="targetDevice"         value="$(targetDevice)" />
   </process>

   <!-- 
         Exclude unused files
     -->
   <process
      type="org.eclipse.cdt.managedbuilder.core.ExcludeResources">
      <simple       name="projectName"           value="$(projectName)" />
      <simple       name="configIdPattern"       value=".*" />
      <simple-array name="filePatterns" >
         <element value="/$(projectName)/$(excludedFilesPattern)" />
      </simple-array>
      <simple       name="invertConfigMatching"  value="false" />
   </process>

   <!-- 
         open main file 
     -->
   <process type="org.eclipse.cdt.ui.OpenFiles">
      <simple name="projectName" value="$(projectName)"/>
      <complex-array name="files">
         <element>
            <simple name="target" value="Sources/main.c"/>
         </element>
      </complex-array>
   </process>

</template>

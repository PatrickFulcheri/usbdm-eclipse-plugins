<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USBDM: usb.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">USBDM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">usb.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/** </span></div><div class="line"><span class="comment">    @file usb.cpp</span></div><div class="line"><span class="comment">    @brief Simple USB Stack for Kinetis</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    @version  V4.12.1.150</span></div><div class="line"><span class="comment">    @date     13 Nov 2016</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   \verbatim</span></div><div class="line"><span class="comment">    Kinetis USB Code</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    Copyright (C) 2008-16  Peter O&#39;Donoghue</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    This program is free software; you can redistribute it and/or modify</span></div><div class="line"><span class="comment">    it under the terms of the GNU General Public License as published by</span></div><div class="line"><span class="comment">    the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><span class="comment">    (at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    This program is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment">    GNU General Public License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    You should have received a copy of the GNU General Public License</span></div><div class="line"><span class="comment">    along with this program; if not, write to the Free Software</span></div><div class="line"><span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></div><div class="line"><span class="comment">    \endverbatim</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">\verbatim</span></div><div class="line"><span class="comment">Change History</span></div><div class="line"><span class="comment">+=================================================================================</span></div><div class="line"><span class="comment">| 20 Oct 2016 | Created</span></div><div class="line"><span class="comment">+=================================================================================</span></div><div class="line"><span class="comment">\endverbatim</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> * *** DO NOT EDIT THIS FILE ***</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is generated automatically.</span></div><div class="line"><span class="comment"> * Any manual changes will be lost.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="derivative_8h.html">derivative.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="usb_8h.html">usb.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a> {</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** BDTs organised by endpoint, odd/even, tx/rx */</span></div><div class="line"><a name="_a0"></a><a class="code" href="struct_endpoint_bdt_entry.html">EndpointBdtEntry</a> <a name="a1"></a><a class="code" href="namespace_u_s_b_d_m.html#a68ae1e816cd51d3dc3b4b01feb8ab6a7">endPointBdts</a>[Usb0::NUMBER_OF_ENDPOINTS] __attribute__ ((aligned (512)));</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef MS_COMPATIBLE_ID_FEATURE</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <a name="_a2"></a><a class="code" href="struct_m_s___compatible_id_feature_descriptor.html">MS_CompatibleIdFeatureDescriptor</a> <a name="a3"></a><a class="code" href="namespace_u_s_b_d_m.html#a3323e58e907f673ea9061ec3697b8826">msCompatibleIdFeatureDescriptor</a> = {</div><div class="line">      <span class="comment">/* lLength;             */</span>  <a name="a4"></a><a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>((uint32_t)<span class="keyword">sizeof</span>(<a class="code" href="struct_m_s___compatible_id_feature_descriptor.html">MS_CompatibleIdFeatureDescriptor</a>)),</div><div class="line">      <span class="comment">/* wVersion;            */</span>  <a name="a5"></a><a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(0x0100),</div><div class="line">      <span class="comment">/* wIndex;              */</span>  <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(0x0004),</div><div class="line">      <span class="comment">/* bnumSections;        */</span>  1,</div><div class="line">      <span class="comment">/*---------------------- Section 1 -----------------------------*/</span></div><div class="line">      <span class="comment">/* bReserved1[7];       */</span>  {0},</div><div class="line">      <span class="comment">/* bInterfaceNum;       */</span>  0,</div><div class="line">      <span class="comment">/* bReserved2;          */</span>  1,</div><div class="line">      <span class="comment">/* bCompatibleId[8];    */</span>  <span class="stringliteral">&quot;WINUSB\0&quot;</span>,</div><div class="line">      <span class="comment">/* bSubCompatibleId[8]; */</span>  {0},</div><div class="line">      <span class="comment">/* bReserved3[6];       */</span>  {0}</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">const</span> MS_PropertiesFeatureDescriptor <a name="a6"></a><a class="code" href="namespace_u_s_b_d_m.html#a5c4b1c09fec8648a1fe5a9ac4826e32b">msPropertiesFeatureDescriptor</a> = {</div><div class="line">      <span class="comment">/* uint32_t lLength;         */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>((uint32_t)<span class="keyword">sizeof</span>(MS_PropertiesFeatureDescriptor)),</div><div class="line">      <span class="comment">/* uint16_t wVersion;        */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(0x0100),</div><div class="line">      <span class="comment">/* uint16_t wIndex;          */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(5),</div><div class="line">      <span class="comment">/* uint16_t bnumSections;    */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(2),</div><div class="line">      <span class="comment">/*---------------------- Section 1 -----------------------------*/</span></div><div class="line">      <span class="comment">/* uint32_t lPropertySize0;  */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.lPropertySize0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.ldataType0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.wNameLength0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bName0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.wPropertyLength0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bData0)</div><div class="line">      ),</div><div class="line">      <span class="comment">/* uint32_t ldataType0;       */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(1U), <span class="comment">// 1 = Unicode string</span></div><div class="line">      <span class="comment">/* uint16_t wNameLength0;     */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(<span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bName0)),</div><div class="line">      <span class="comment">/* char16_t bName0[42];       */</span> MS_DEVICE_INTERFACE_GUIDs,</div><div class="line">      <span class="comment">/* uint32_t wPropertyLength0; */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(<span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bData0)),</div><div class="line">      <span class="comment">/* char16_t bData0[78];       */</span> MS_DEVICE_GUID,</div><div class="line">      <span class="comment">/*---------------------- Section 2 -----------------------------*/</span></div><div class="line">      <span class="comment">/* uint32_t lPropertySize1;   */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.lPropertySize1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.ldataType1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.wNameLength1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bName1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.wPropertyLength1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bData1)</div><div class="line">      ),</div><div class="line">      <span class="comment">/* uint32_t ldataType1;       */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(2U), <span class="comment">// 2 = Unicode string with environment variables</span></div><div class="line">      <span class="comment">/* uint16_t wNameLength1;     */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(<span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bName1)),</div><div class="line">      <span class="comment">/* uint8_t  bName1[];         */</span> MS_ICONS,</div><div class="line">      <span class="comment">/* uint32_t wPropertyLength1; */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(<span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bData1)),</div><div class="line">      <span class="comment">/* uint8_t  bData1[];         */</span> MS_ICON_PATH,</div><div class="line">};</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Get name of USB token</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param  token USB token</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Pointer to static string</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a name="a7"></a><a class="code" href="class_u_s_b_d_m_1_1_usb_base.html#af094da3f6dc8c7920d5be5f402b0306a">UsbBase::getTokenName</a>(<span class="keywordtype">unsigned</span> token) {</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *names[] = {</div><div class="line">         <span class="stringliteral">&quot;Unknown #0&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;OUTToken&quot;</span>,   <span class="comment">//  (0x1) - Out token</span></div><div class="line">         <span class="stringliteral">&quot;ACKToken&quot;</span>,   <span class="comment">//  (0x2) - Acknowledge</span></div><div class="line">         <span class="stringliteral">&quot;DATA0Token&quot;</span>, <span class="comment">//  (0x3) - Data 0</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #4&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;SOFToken&quot;</span>,   <span class="comment">//  (0x5) - Start of Frame token</span></div><div class="line">         <span class="stringliteral">&quot;NYETToken&quot;</span>,  <span class="comment">//  (0x6) - No Response Yet</span></div><div class="line">         <span class="stringliteral">&quot;DATA2Token&quot;</span>, <span class="comment">//  (0x7) - Data 2</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #8&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;INToken&quot;</span>,    <span class="comment">//  (0x9) - In token</span></div><div class="line">         <span class="stringliteral">&quot;NAKToken&quot;</span>,   <span class="comment">//  (0xA) - Negative Acknowledge</span></div><div class="line">         <span class="stringliteral">&quot;DATA1Token&quot;</span>, <span class="comment">//  (0xB) - Data 1</span></div><div class="line">         <span class="stringliteral">&quot;PREToken&quot;</span>,   <span class="comment">//  (0xC) - Preamble</span></div><div class="line">         <span class="stringliteral">&quot;SETUPToken&quot;</span>, <span class="comment">//  (0xD) - Setup token</span></div><div class="line">         <span class="stringliteral">&quot;STALLToken&quot;</span>, <span class="comment">//  (0xE) - Stall</span></div><div class="line">         <span class="stringliteral">&quot;MDATAToken&quot;</span>, <span class="comment">//  (0xF) - M data</span></div><div class="line">   };</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *rc = <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line">   <span class="keywordflow">if</span> (token&lt;(<span class="keyword">sizeof</span>(names)/<span class="keyword">sizeof</span>(names[0]))) {</div><div class="line">      rc = names[token];</div><div class="line">   }</div><div class="line">   <span class="keywordflow">return</span> rc;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Get name of USB state</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param  state USB state</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Pointer to static string</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a name="a8"></a><a class="code" href="class_u_s_b_d_m_1_1_usb_base.html#a96cb1348176cc7660add932dc5fa7801">UsbBase::getStateName</a>(<a name="a9"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacd">EndpointState</a> state){</div><div class="line">   <span class="keywordflow">switch</span> (state) {</div><div class="line">      default         : <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line">      <span class="keywordflow">case</span> <a name="a10"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacdafa90f9e0eb7ee888a8d2d32383523255">EPIdle</a>     : <span class="keywordflow">return</span> <span class="stringliteral">&quot;EPIdle&quot;</span>;</div><div class="line">      <span class="keywordflow">case</span> <a name="a11"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacdad7d2d462ab230f223603c1aeebb1c2f8">EPDataIn</a>   : <span class="keywordflow">return</span> <span class="stringliteral">&quot;EPDataIn&quot;</span>;</div><div class="line">      <span class="keywordflow">case</span> <a name="a12"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacda0f056f12ece9450fe381e8ea569e2581">EPDataOut</a>  : <span class="keywordflow">return</span> <span class="stringliteral">&quot;EPDataOut,&quot;</span>;</div><div class="line">      <span class="keywordflow">case</span> <a name="a13"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacda7109db88f188beeb036a3eecf73da57d">EPStatusIn</a> : <span class="keywordflow">return</span> <span class="stringliteral">&quot;EPStatusIn&quot;</span>;</div><div class="line">      <span class="keywordflow">case</span> <a name="a14"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacdad4c4f58fff83bae71b30192d0d19ef29">EPStatusOut</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;EPStatusOut&quot;</span>;</div><div class="line">      <span class="keywordflow">case</span> <a name="a15"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacda0c9d3761bdfb6fe05f07da457b79a555">EPThrottle</a> : <span class="keywordflow">return</span> <span class="stringliteral">&quot;EPThrottle&quot;</span>;</div><div class="line">      <span class="keywordflow">case</span> <a name="a16"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacdaf3e9e17727f63e4ce421f83b6b147db5">EPStall</a>    : <span class="keywordflow">return</span> <span class="stringliteral">&quot;EPStall&quot;</span>;</div><div class="line">      <span class="keywordflow">case</span> <a name="a17"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacdaec587fdb5a2a3892dda005fce036968e">EPComplete</a> : <span class="keywordflow">return</span> <span class="stringliteral">&quot;EPComplete&quot;</span>;</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Get name of USB request</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param  reqType Request type</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Pointer to static string</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a name="a18"></a><a class="code" href="class_u_s_b_d_m_1_1_usb_base.html#a1db43730921b98952b7fd994e8ddb163">UsbBase::getRequestName</a>(uint8_t reqType){</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *names[] = {</div><div class="line">         <span class="stringliteral">&quot;GET_STATUS&quot;</span>,              <span class="comment">/* 0x00 */</span></div><div class="line">         <span class="stringliteral">&quot;CLEAR_FEATURE&quot;</span>,           <span class="comment">/* 0x01 */</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #2&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;SET_FEATURE&quot;</span>,             <span class="comment">/* 0x03 */</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #4&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;SET_ADDRESS&quot;</span>,             <span class="comment">/* 0x05 */</span></div><div class="line">         <span class="stringliteral">&quot;GET_DESCRIPTOR&quot;</span>,          <span class="comment">/* 0x06 */</span></div><div class="line">         <span class="stringliteral">&quot;SET_DESCRIPTOR&quot;</span>,          <span class="comment">/* 0x07 */</span></div><div class="line">         <span class="stringliteral">&quot;GET_CONFIGURATION&quot;</span>,       <span class="comment">/* 0x08 */</span></div><div class="line">         <span class="stringliteral">&quot;SET_CONFIGURATION&quot;</span>,       <span class="comment">/* 0x09 */</span></div><div class="line">         <span class="stringliteral">&quot;GET_INTERFACE&quot;</span>,           <span class="comment">/* 0x0a */</span></div><div class="line">         <span class="stringliteral">&quot;SET_INTERFACE&quot;</span>,           <span class="comment">/* 0x0b */</span></div><div class="line">         <span class="stringliteral">&quot;SYNCH_FRAME&quot;</span>,             <span class="comment">/* 0x0c */</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #D&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;Unknown #E&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;Unknown #F&quot;</span>,</div><div class="line">   };</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *rc = <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line">   <span class="keywordflow">if</span> (reqType&lt;(<span class="keyword">sizeof</span>(names)/<span class="keyword">sizeof</span>(names[0]))) {</div><div class="line">      rc = names[reqType];</div><div class="line">   }</div><div class="line">   <span class="keywordflow">return</span> rc;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Report contents of BDT</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param name    Descriptive name to use</span></div><div class="line"><span class="comment"> * @param bdt     BDT to report</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a19"></a><a class="code" href="class_u_s_b_d_m_1_1_usb_base.html#a6ba2132e7da726207caec888b86a3a92">UsbBase::reportBdt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a name="_a20"></a><a class="code" href="struct_bdt_entry.html">BdtEntry</a> *bdt) {</div><div class="line">   (void)name;</div><div class="line">   (void)bdt;</div><div class="line">   <span class="keywordflow">if</span> (bdt-&gt;<a name="a21"></a><a class="code" href="struct_bdt_entry.html#aa9f82ffe4aa47c8343c6b2c40bbbc143">u</a>.<a name="a22"></a><a class="code" href="struct_bdt_entry.html#ab742673751b8eb88fe09a9d56570f86a">setup</a>.own) {</div><div class="line">      <a name="a23"></a><a class="code" href="utilities_8h.html#a1f464e950a4fa11e8821b5c725921a15">PRINTF</a>(<span class="stringliteral">&quot;%s addr=0x%08lX, bc=%d, %s, %s, %s\n&quot;</span>,</div><div class="line">            name,</div><div class="line">            bdt-&gt;<a name="a24"></a><a class="code" href="struct_bdt_entry.html#ad25182ffafa9a8eb0b86a17028ee0f7a">addr</a>, bdt-&gt;<a name="a25"></a><a class="code" href="struct_bdt_entry.html#aa4e4e1c284504ce3f75cb15970755972">bc</a>,</div><div class="line">            bdt-&gt;<a class="code" href="struct_bdt_entry.html#aa9f82ffe4aa47c8343c6b2c40bbbc143">u</a>.<a class="code" href="struct_bdt_entry.html#ab742673751b8eb88fe09a9d56570f86a">setup</a>.data0_1?<span class="stringliteral">&quot;DATA1&quot;</span>:<span class="stringliteral">&quot;DATA0&quot;</span>,</div><div class="line">                  bdt-&gt;<a class="code" href="struct_bdt_entry.html#aa9f82ffe4aa47c8343c6b2c40bbbc143">u</a>.<a class="code" href="struct_bdt_entry.html#ab742673751b8eb88fe09a9d56570f86a">setup</a>.bdt_stall?<span class="stringliteral">&quot;STALL&quot;</span>:<span class="stringliteral">&quot;OK&quot;</span>,</div><div class="line">                        <span class="stringliteral">&quot;USB&quot;</span></div><div class="line">      );</div><div class="line">   }</div><div class="line">   <span class="keywordflow">else</span> {</div><div class="line">      <a class="code" href="utilities_8h.html#a1f464e950a4fa11e8821b5c725921a15">PRINTF</a>(<span class="stringliteral">&quot;%s addr=0x%08lX, bc=%d, %s, %s\n&quot;</span>,</div><div class="line">            name,</div><div class="line">            bdt-&gt;<a class="code" href="struct_bdt_entry.html#ad25182ffafa9a8eb0b86a17028ee0f7a">addr</a>, bdt-&gt;<a class="code" href="struct_bdt_entry.html#aa4e4e1c284504ce3f75cb15970755972">bc</a>,</div><div class="line">            <a class="code" href="class_u_s_b_d_m_1_1_usb_base.html#af094da3f6dc8c7920d5be5f402b0306a">getTokenName</a>(bdt-&gt;<a class="code" href="struct_bdt_entry.html#aa9f82ffe4aa47c8343c6b2c40bbbc143">u</a>.<a name="a26"></a><a class="code" href="struct_bdt_entry.html#aca574cd3686667cd0fc61d2122a04987">result</a>.tok_pid),</div><div class="line">            <span class="stringliteral">&quot;PROC&quot;</span></div><div class="line">      );</div><div class="line">   }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> reportLineCoding(<span class="keyword">const</span> <a name="_a27"></a><a class="code" href="struct_line_coding_structure.html">LineCodingStructure</a> *lineCodingStructure) {</div><div class="line">   (void)lineCodingStructure;</div><div class="line">   <a class="code" href="utilities_8h.html#a1f464e950a4fa11e8821b5c725921a15">PRINTF</a>(<span class="stringliteral">&quot;rate   = %ld bps\n&quot;</span>, lineCodingStructure-&gt;<a name="a28"></a><a class="code" href="struct_line_coding_structure.html#a26727c8652d7ac68431f5857a9f7b8d1">dwDTERate</a>);</div><div class="line">   <a class="code" href="utilities_8h.html#a1f464e950a4fa11e8821b5c725921a15">PRINTF</a>(<span class="stringliteral">&quot;format = %d\n&quot;</span>, lineCodingStructure-&gt;<a name="a29"></a><a class="code" href="struct_line_coding_structure.html#a6433de99b826bbf4d4f30da00911f3c5">bCharFormat</a>);</div><div class="line">   <a class="code" href="utilities_8h.html#a1f464e950a4fa11e8821b5c725921a15">PRINTF</a>(<span class="stringliteral">&quot;parity = %d\n&quot;</span>, lineCodingStructure-&gt;<a name="a30"></a><a class="code" href="struct_line_coding_structure.html#a0f726286e02df447d1ba9f20174226cf">bParityType</a>);</div><div class="line">   <a class="code" href="utilities_8h.html#a1f464e950a4fa11e8821b5c725921a15">PRINTF</a>(<span class="stringliteral">&quot;bits   = %d\n&quot;</span>, lineCodingStructure-&gt;<a name="a31"></a><a class="code" href="struct_line_coding_structure.html#a2bea24b1b35e16ebe506abeeb8e5e233">bDataBits</a>);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Format SETUP packet as string</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param p SETUP packet</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Pointer to static buffer</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a name="a32"></a><a class="code" href="class_u_s_b_d_m_1_1_usb_base.html#ad4d6596155453e8113c89559dc49df38">UsbBase::reportSetupPacket</a>(<a name="_a33"></a><a class="code" href="struct_setup_packet.html">SetupPacket</a> *p) {</div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">char</span> buff[100];</div><div class="line">   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;[%2X,%s,%d,%d,%d]&quot;</span>,</div><div class="line">         p-&gt;<a name="a34"></a><a class="code" href="struct_setup_packet.html#a5cdaae68cef911cbf007d99765049eac">bmRequestType</a>,</div><div class="line">         <a class="code" href="class_u_s_b_d_m_1_1_usb_base.html#a1db43730921b98952b7fd994e8ddb163">getRequestName</a>(p-&gt;<a name="a35"></a><a class="code" href="struct_setup_packet.html#ad842507438aaa73071063de510f3411f">bRequest</a>),</div><div class="line">         (<span class="keywordtype">int</span>)(p-&gt;<a name="a36"></a><a class="code" href="struct_setup_packet.html#aa50a7f2174d3739c0dd7daf131765087">wValue</a>),</div><div class="line">         (<span class="keywordtype">int</span>)(p-&gt;<a name="a37"></a><a class="code" href="struct_setup_packet.html#acf32f5e5a54de111cf59cfeaabb59a1e">wIndex</a>),</div><div class="line">         (<span class="keywordtype">int</span>)(p-&gt;<a name="a38"></a><a class="code" href="struct_setup_packet.html#a34cdeb35fde395e236c18d17cc47bf45">wLength</a>)</div><div class="line">   );</div><div class="line">   <span class="keywordflow">return</span> buff;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> reportLineState(uint8_t value) {</div><div class="line">   (void)value;</div><div class="line">   <a class="code" href="utilities_8h.html#a1f464e950a4fa11e8821b5c725921a15">PRINTF</a>(<span class="stringliteral">&quot;Line state: RTS=%d, DTR=%d\n&quot;</span>, (value&amp;(1&lt;&lt;1))?1:0, (value&amp;(1&lt;&lt;0))?1:0);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> *  Creates a valid string descriptor in UTF-16-LE from a limited UTF-8 string</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  @param to       Where to place descriptor</span></div><div class="line"><span class="comment"> *  @param from     Zero terminated UTF-8 C string</span></div><div class="line"><span class="comment"> *  @param maxSize  Size of destination</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  @note Only handles UTF-8 characters that fit in a single UTF-16 value.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a39"></a><a class="code" href="class_u_s_b_d_m_1_1_usb_base.html#a46692eea4c20df70d42c1a8e6c794a38">UsbBase::utf8ToStringDescriptor</a>(uint8_t *to, <span class="keyword">const</span> uint8_t *from, <span class="keywordtype">unsigned</span> maxSize) {</div><div class="line">   uint8_t *size = to; <span class="comment">// 1st byte is where to place descriptor size</span></div><div class="line"></div><div class="line">   *to++ = 2;         <span class="comment">// 1st byte = descriptor size (2 bytes so far)</span></div><div class="line">   *to++ = <a name="a40"></a><a class="code" href="usb__defs_8h.html#a8513ab325267ccde08483478c67eecf2">DT_STRING</a>; <span class="comment">// 2nd byte = descriptor type, DT_STRING;</span></div><div class="line"></div><div class="line">   <span class="keywordflow">while</span> (*from != <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line">      <span class="comment">// Buffer for converted character</span></div><div class="line">      uint16_t utf16Char=0;</div><div class="line"></div><div class="line">      <span class="comment">// Update size</span></div><div class="line">      *size  += 2;</div><div class="line">      <span class="keywordflow">if</span> (*from &lt; 0x80) {</div><div class="line">         <span class="comment">// 1-byte UTF-8</span></div><div class="line">         utf16Char = *from++;</div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*from &amp;0xE0) == 0xC0){</div><div class="line">         <span class="comment">// 2-byte UTF-8</span></div><div class="line">         utf16Char  = (0x1F&amp;*from++)&lt;&lt;6;</div><div class="line">         utf16Char += (0x3F&amp;*from++);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*from &amp;0xF0) == 0xE0){</div><div class="line">         <span class="comment">// 3-byte UTF-8</span></div><div class="line">         utf16Char  = (0x0F&amp;*from++)&lt;&lt;12;</div><div class="line">         utf16Char += (0x3F&amp;*from++)&lt;&lt;6;</div><div class="line">         utf16Char += (0x3F&amp;*from++);</div><div class="line">      }</div><div class="line">      <span class="comment">// Write UTF-16LE value</span></div><div class="line">      *to++ = (char)utf16Char;</div><div class="line">      *to++ = (char)(utf16Char&gt;&gt;8);</div><div class="line">      <span class="keywordflow">if</span> (*size&gt;=maxSize) {</div><div class="line">         <span class="comment">// Truncate value</span></div><div class="line">         <span class="keywordflow">break</span>;</div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div><div class="line"></div><div class="line">} <span class="comment">// End namespace USBDM</span></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Aug 12 2017 08:54:36 for USBDM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

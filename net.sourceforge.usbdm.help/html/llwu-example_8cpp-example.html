<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USBDM: llwu-example.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">USBDM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">llwu-example.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> ========================================================================================</span></div><div class="line"><span class="comment"> * @file    llwu-example.cpp (180.ARM_Peripherals)</span></div><div class="line"><span class="comment"> * @brief   Basic C++ demo using LLWU class - very incomplete</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @note To use this demonstration the Console baud rate needs to be reduced to 9600 baud</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  Created on: 10/1/2016</span></div><div class="line"><span class="comment"> *      Author: podonoghue</span></div><div class="line"><span class="comment"> ========================================================================================</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="system_8h.html">system.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="derivative_8h.html">derivative.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="hardware_8h.html">hardware.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="delay_8h.html">delay.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="console_8h.html">console.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mcg_8h.html">mcg.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="llwu_8h.html">llwu.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="smc_8h.html">smc.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="uart_8h.html">uart.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// LED connection - change as required</span></div><div class="line"><span class="keyword">using</span> Led   = <a name="_a0"></a><a class="code" href="class_u_s_b_d_m_1_1_gpio_c.html">USBDM::GpioC&lt;3&gt;</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> llwuCallback() {</div><div class="line">   __asm__(<span class="stringliteral">&quot;nop&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a>;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Low power clock setting</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><a name="_a1"></a><a class="code" href="struct_u_s_b_d_m_1_1_mcg_info_1_1_clock_info.html">McgInfo::ClockInfo</a> vlprClockInfo = {<span class="comment"></span></div><div class="line"><span class="comment">      //! Clock Mode</span></div><div class="line"><span class="comment"></span>      <a name="a2"></a><a class="code" href="class_u_s_b_d_m_1_1_mcg_info.html#a7cf787789cea16c997ea103b417df9c8adc16537f9ead26faa98ebb902f226af2">McgInfo::ClockMode_BLPI</a>,</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Mode flags</span></div><div class="line"><span class="comment"></span>      0,</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Control Register 1</span></div><div class="line"><span class="comment"></span>      <a name="a3"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga39519f6e6a3b433988eca107d0e7d460">MCG_C1_FRDIV</a>(0)   | <span class="comment">// FRDIV    FLL External Reference Divider</span></div><div class="line">      <a name="a4"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga9fc55b990e5876cb6fbeef0bf7caa040">MCG_C1_IRCLKEN</a>(1) | <span class="comment">// IRCLEN   Internal Reference Clock Enable</span></div><div class="line">      <a name="a5"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#gae9002ca9879cd655f9e39f1829b40a03">MCG_C1_IREFSTEN</a>(0), <span class="comment">// IREFSTEN Internal Reference Stop Enable</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Control Register 2</span></div><div class="line"><span class="comment"></span>      <a name="a6"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga3d3b107b5048c654be690911ae09feff">MCG_C2_LOCRE0</a>(0) | <span class="comment">// LOLRE0  Loss of Clock Reset Enable</span></div><div class="line">      <a name="a7"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga4717ad2318b6cbc4586d554b59d0382e">MCG_C2_RANGE0</a>(1) | <span class="comment">// RANGE   Frequency Range Select</span></div><div class="line">      <a name="a8"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga669af3919c558cb8f8c77b8e75abf7cd">MCG_C2_HGO0</a>(0)   | <span class="comment">// HGO     High Gain Oscillator Select</span></div><div class="line">      <a name="a9"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#gae771ee589559392e587838bc2c4f0c14">MCG_C2_EREFS0</a>(1) | <span class="comment">// EREFS   External Reference Select</span></div><div class="line">      <a name="a10"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#gad8f801bcc07391ec8060d0d2249a81be">MCG_C2_IRCS</a>(1),    <span class="comment">// IRCS    Internal Reference Clock Select</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Control Register 4</span></div><div class="line"><span class="comment"></span>      <a name="a11"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga10fd0030b4d3fcb34503269a2a5796c0">MCG_C4_DMX32</a>(0)     | <span class="comment">// DMX32    DCO lock range</span></div><div class="line">      <a name="a12"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#gaf074d694a596e6e92614fd435c9ccb35">MCG_C4_DRST_DRS</a>(0),   <span class="comment">// DRST_DRS DCO Range Select</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Control Register 5</span></div><div class="line"><span class="comment"></span>      <a name="a13"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#gac3faf5c909bfee8fa6b28d1c1e1face7">MCG_C5_PLLCLKEN0</a>(0)  | <span class="comment">// PLLCLKEN0 PLL Clock Enable</span></div><div class="line">      <a name="a14"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga75551114843366d40dd54e1c05fd2002">MCG_C5_PLLSTEN0</a>(0)   | <span class="comment">// PLLSTEN0  PLL Stop Enable</span></div><div class="line">      <a name="a15"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#gaff29a787086eaba9ef46f4e873d83a54">MCG_C5_PRDIV0</a>(0),     <span class="comment">// PRDIV0    PLL External Reference Divider</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Control Register 6</span></div><div class="line"><span class="comment"></span>      <a name="a16"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga40c69a7a688af5b94cb89b84e1afa446">MCG_C6_LOLIE0</a>(0) | <span class="comment">// LOLIE0 Loss of Lock interrupt Enable</span></div><div class="line">      <a name="a17"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga70d94d0060b62ceb42672a91ebe51c73">MCG_C6_CME0</a>(0)   | <span class="comment">// CME0   Clock Monitor Enable</span></div><div class="line">      <a name="a18"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga50b2068270153c3013b4e0ac2256fbfd">MCG_C6_VDIV0</a>(0),   <span class="comment">// VDIV0  PLL VCO Divider</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Status and Control Register</span></div><div class="line"><span class="comment"></span>      <a name="a19"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga50a0225002267599fa7a2fc341fa783a">MCG_SC_FCRDIV</a>(0), <span class="comment">// FCRDIV Internal Clock Reference Divider</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Control Register 7</span></div><div class="line"><span class="comment"></span>      <a name="a20"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#gac1a1e06d2189b74b5587b53d3104cb4a">MCG_C7_OSCSEL</a>(0), <span class="comment">// OSCSEL MCG OSC Clock Select</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      //! Control Register 8</span></div><div class="line"><span class="comment"></span>      <a name="a21"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga737fe26be9d82a9b0e2b841216f469dc">MCG_C8_LOCRE1</a>(0) | <span class="comment">// LOCRE1 RTC Loss of Clock Reset Enable</span></div><div class="line">      <a name="a22"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#ga882f76d0b8c7e3045f2df6369cc794d1">MCG_C8_LOLRE</a>(0)  | <span class="comment">// LOLRE  PLL Loss of Lock Reset Enable</span></div><div class="line">      <a name="a23"></a><a class="code" href="group___m_c_g___register___masks___g_r_o_u_p.html#gacfd4bf40d2ff518561d54938851479ef">MCG_C8_CME1</a>(0),    <span class="comment">// CME1   Clock Monitor Enable 1</span></div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a24"></a><a class="code" href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div><div class="line">   <a name="a25"></a><a class="code" href="console_8h.html#a92d0afe227a90817b0a06ec00667bdd3">console_setBaudRate</a>(9600);</div><div class="line"></div><div class="line">   printf(<span class="stringliteral">&quot;Starting\n&quot;</span>);</div><div class="line"></div><div class="line">   printf(<span class="stringliteral">&quot;Core freq = %ld\n&quot;</span>, ::<a name="a26"></a><a class="code" href="namespace_u_s_b_d_m.html#ae273916efc481beb47089bdea2c8f415">SystemCoreClock</a>);</div><div class="line"></div><div class="line">   USBDM::Llwu::configure();</div><div class="line">   <a name="a27"></a><a class="code" href="class_u_s_b_d_m_1_1_llwu_irq___t.html#a67f5f9640bbc124b92366f0294e83e57">USBDM::Llwu::setCallback</a>(llwuCallback);</div><div class="line"></div><div class="line">   USBDM::Smc::initialise();</div><div class="line"></div><div class="line">   Led::setOutput();</div><div class="line"></div><div class="line">   <span class="keywordflow">for</span> (;;) {</div><div class="line">      Led::toggle();</div><div class="line"></div><div class="line">      <a name="a28"></a><a class="code" href="class_u_s_b_d_m_1_1_mcg.html#a7923ecc8a523c04b79eb576c479699e8">USBDM::Mcg::clockTransition</a>(vlprClockInfo);</div><div class="line">      <a class="code" href="console_8h.html#a92d0afe227a90817b0a06ec00667bdd3">console_setBaudRate</a>(9600);</div><div class="line">      USBDM::Smc::enterPowerMode(Smc::runm_vlpr);</div><div class="line">      printf(<span class="stringliteral">&quot;LP Core freq = %ld\n&quot;</span>, ::<a class="code" href="namespace_u_s_b_d_m.html#ae273916efc481beb47089bdea2c8f415">SystemCoreClock</a>);</div><div class="line">      printf(<span class="stringliteral">&quot;mode = %d\n&quot;</span>, Smc::getPowerMode());</div><div class="line">      <a name="a29"></a><a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">USBDM::waitMS</a>(1000);</div><div class="line"></div><div class="line">      USBDM::Smc::enterPowerMode(Smc::runm_run);</div><div class="line">      <a class="code" href="class_u_s_b_d_m_1_1_mcg.html#a7923ecc8a523c04b79eb576c479699e8">USBDM::Mcg::clockTransition</a>(<a name="a30"></a><a class="code" href="class_u_s_b_d_m_1_1_mcg_info.html#af470959f78db238c717916611065e3ce">USBDM::McgInfo::clockInfo</a>[0]);</div><div class="line">      <a class="code" href="console_8h.html#a92d0afe227a90817b0a06ec00667bdd3">console_setBaudRate</a>(9600);</div><div class="line">      printf(<span class="stringliteral">&quot;LP Core freq = %ld\n&quot;</span>, ::<a class="code" href="namespace_u_s_b_d_m.html#ae273916efc481beb47089bdea2c8f415">SystemCoreClock</a>);</div><div class="line">      printf(<span class="stringliteral">&quot;mode = %d\n&quot;</span>, Smc::getPowerMode());</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">USBDM::waitMS</a>(1000);</div><div class="line">   }</div><div class="line">   <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 21 2017 07:45:21 for USBDM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
